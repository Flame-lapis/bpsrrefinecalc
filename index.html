<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>í”ŒëŒë¼í”¼ìŠ¤ì˜ ì¥ë¹„ ì¬ë£Œ ê³„ì‚°ê¸°</title>
    <style>
        :root {
            --primary-color: #ff3e81; --point-color: #4bffb0; --gold-color: #ffae00; 
            --npc-color: #00d4ff; --bg-color: #1a1a1b; --card-bg: #2d2d2e; --error-color: #ff4d4d;
        }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg-color); color: #fff; display: flex; justify-content: center; padding: 20px 10px; margin: 0; }
        .calc-card { background: var(--card-bg); padding: 25px; border-radius: 15px; width: 100%; max-width: 600px; border: 1px solid #444; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { text-align: center; color: var(--primary-color); margin-bottom: 20px; font-size: 1.4em; margin-top: 0; }
        
        .section-title { font-size: 0.9em; color: var(--gold-color); margin: 20px 0 10px 0; font-weight: bold; border-bottom: 1px solid #444; padding-bottom: 5px; }

        /* ìƒë‹¨ ì¼ê´„ ì œì–´íŒ */
        .batch-control { background: #3d3d3f; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #555; }
        .batch-buttons { display: flex; gap: 8px; margin-bottom: 12px; }
        .batch-btn { flex: 1; padding: 10px; border-radius: 6px; border: none; background: #555; color: #fff; font-size: 0.85em; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .batch-btn:active { transform: scale(0.98); }
        .batch-select-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; align-items: center; }
        .batch-select-row label { font-size: 0.75em; color: #bbb; display: block; margin-bottom: 4px; text-align: center; }

        .equip-header { display: grid; grid-template-columns: 138px 1fr 20px 1fr; gap: 8px; margin-bottom: 5px; padding: 0 10px; font-size: 0.75em; color: #aaa; text-align: center; }

        .equip-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px; }
        .equip-row-container { display: flex; flex-direction: column; }
        .equip-item { display: grid; grid-template-columns: 30px 100px 1fr 20px 1fr; align-items: center; background: #363637; padding: 10px; border-radius: 8px; gap: 8px; border: 1px solid transparent; transition: 0.2s; }
        .equip-item.inactive { opacity: 0.4; }
        .equip-item.error { border-color: var(--error-color); background: #3d2626; border-bottom-left-radius: 0; border-bottom-right-radius: 0; }
        
        .row-error-msg { background: var(--error-color); color: #fff; font-size: 0.7em; padding: 4px 10px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; display: none; font-weight: bold; text-align: center; }
        
        input[type="checkbox"] { accent-color: var(--primary-color); width: 18px; height: 18px; cursor: pointer; }
        .equip-name { font-size: 0.85em; font-weight: bold; }
        
        select { width: 100%; padding: 6px; background: #1a1a1b; border: 1px solid #555; color: #fff; border-radius: 4px; font-size: 13px; text-align: center; cursor: pointer; }
        select:disabled { cursor: not-allowed; background: #222; color: #666; }

        .btn-calc { width: 100%; padding: 16px; background: var(--primary-color); color: white; border: none; border-radius: 10px; font-size: 1.1em; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.2s; box-shadow: 0 4px 10px rgba(255, 62, 129, 0.3); }
        .btn-calc:active { transform: scale(0.98); }

        .result-area { margin-top: 25px; padding: 20px; background: #1a1a1b; border-radius: 10px; border: 1px dashed #555; display: none; }
        .result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .result-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 0.95em; border-bottom: 1px solid #333; padding-bottom: 8px; }
        .item-info { display: flex; align-items: center; gap: 8px; }
        .item-icon { width: 28px; height: 28px; object-fit: contain; border-radius: 4px; background: #2d2d2e; padding: 2px; }
        
        .highlight { color: var(--point-color); font-weight: bold; }
        .val-text { color: var(--npc-color); font-weight: bold; }
        .stone-row { grid-column: span 2; background: #2d2d2e; padding: 10px; border-radius: 8px; margin-top: 5px; border: 1px solid #444; }
    </style>
</head>
<body>

<div class="calc-card">
    <h2>âš”ï¸ ì •ë ¨ ì¬ë£Œ ê³„ì‚°ê¸°</h2>

    <div class="batch-control">
        <div class="batch-buttons">
            <button class="batch-btn" onclick="setAllCheckboxes(true)">ëª¨ë“  ë¶€ìœ„ ì„ íƒ</button>
            <button class="batch-btn" onclick="setAllCheckboxes(false)">ëª¨ë“  ë¶€ìœ„ í•´ì œ</button>
        </div>
        <div class="batch-select-row">
            <div>
                <label>ì¼ê´„ í˜„ì¬ ë ˆë²¨</label>
                <select id="batchCurr" onchange="applyBatchLevel('curr')"></select>
            </div>
            <div>
                <label>ì¼ê´„ ëª©í‘œ ë ˆë²¨</label>
                <select id="batchTarget" onchange="applyBatchLevel('target')"></select>
            </div>
        </div>
    </div>
    
    <div class="section-title">ğŸ›¡ï¸ ë¶€ìœ„ë³„ ì •ë ¨ ë ˆë²¨ ì„¤ì •</div>
    
    <div class="equip-header">
        <div>ë¶€ìœ„ ì„ íƒ</div>
        <div>í˜„ì¬ ë ˆë²¨</div>
        <div></div>
        <div>ëª©í‘œ ë ˆë²¨</div>
    </div>

    <div class="equip-list" id="equipList"></div>
    
    <button class="btn-calc" onclick="calculateAll()">ì„ íƒí•œ ë¶€ìœ„ì˜ ì •ë ¨ ì¬ë£Œ í•©ì‚°í•˜ê¸°</button>

    <div id="resultArea" class="result-area">
        <div class="section-title" style="margin-top:0; border-color: var(--point-color);">ğŸ“Š í•„ìš” ì¬ë£Œ í•©ì‚° ê²°ê³¼</div>
        <div class="result-grid" id="resultContent"></div>
    </div>
</div>

<script>
    const icons = {
        en1: "item_icons_star_crystal_01.webp",
        en2: "item_icons_star_crystal_02.webp",
        metal: "item_icons_god_metal_01.webp",
        light: "item_icons_aluminium_01.webp",
        crystal: "item_icons_god_metal_02.webp",
        bri: "item_icons_equipment gems_01.webp",
        moss: "item_icons_equipment gems_02.webp"
    };

    const dataRef = {
        weapon: {
            bri: [0,0,0,0,0,0,1,1,1,2,3,4,5,5,5,5,5,5,5,5,5],
            moss: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,10],
            en1: [0,2,2,4,4,6,6,8,8,10,10,0,0,0,0,0,0,0,0,0,0],
            en2: [0,0,0,0,0,0,0,0,0,0,0,4,4,5,5,6,7,8,10,12,14],
            stone: [0,6,6,12,16,24,30,40,40,50,50,60,60,70,70,80,80,80,100,100,120]
        },
        armor: {
            bri: [0,0,0,0,0,0,1,1,1,2,3,4,5,5,5,5,5,5,5,5,5],
            moss: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,10],
            en1: [0,1,1,2,2,3,3,4,4,5,5,0,0,0,0,0,0,0,0,0,0],
            en2: [0,0,0,0,0,0,0,0,0,0,0,2,2,2,3,3,4,4,5,6,8],
            stone: [0,3,3,6,8,12,15,20,20,25,25,30,30,35,35,40,40,40,50,50,60]
        }
    };

    const equips = [
        { id: 'w1', name: 'ë¬´ê¸°', type: 'weapon', stoneKey: 'metal' },
        { id: 'a1', name: 'íˆ¬êµ¬', type: 'armor', stoneKey: 'metal' },
        { id: 'a2', name: 'ìƒì˜', type: 'armor', stoneKey: 'metal' },
        { id: 'g1', name: 'ì¥ê°‘', type: 'armor', stoneKey: 'light' },
        { id: 's1', name: 'ì‹ ë°œ', type: 'armor', stoneKey: 'light' },
        { id: 'e1', name: 'ê·€ê±¸ì´', type: 'armor', stoneKey: 'light' },
        { id: 'm1', name: 'ëª©ê±¸ì´', type: 'armor', stoneKey: 'light' },
        { id: 'r1', name: 'ë°˜ì§€', type: 'armor', stoneKey: 'crystal' },
        { id: 'p1', name: 'íŒ”ì°Œ(ì™¼)', type: 'armor', stoneKey: 'crystal' },
        { id: 'p2', name: 'íŒ”ì°Œ(ìš°)', type: 'armor', stoneKey: 'crystal' },
        { id: 't1', name: 'íƒˆë¦¬ìŠ¤ë§Œ', type: 'armor', stoneKey: 'crystal' }
    ];

    function init() {
        const container = document.getElementById('equipList');
        const batchCurr = document.getElementById('batchCurr');
        const batchTarget = document.getElementById('batchTarget');

        let options = '';
        for(let i=0; i<=20; i++) options += `<option value="${i}">${i}</option>`;
        
        batchCurr.innerHTML = options;
        batchTarget.innerHTML = options.replace('value="20"', 'value="20" selected');

        equips.forEach(eq => {
            container.innerHTML += `
                <div class="equip-row-container">
                    <div class="equip-item inactive" id="row-${eq.id}">
                        <input type="checkbox" id="chk-${eq.id}" onchange="toggleRow('${eq.id}')">
                        <span class="equip-name">${eq.name}</span>
                        <select id="curr-${eq.id}" disabled onchange="handleInputChange('${eq.id}')">${options}</select>
                        <span style="color:#555">â–¶</span>
                        <select id="target-${eq.id}" disabled onchange="handleInputChange('${eq.id}')">${options.replace('value="0"', 'value="0"').replace('value="20"', 'value="20" selected')}</select>
                    </div>
                    <div id="error-${eq.id}" class="row-error-msg">ëª©í‘œ ë ˆë²¨ì´ í˜„ì¬ ë ˆë²¨ ë³´ë‹¤ ë‚®ìŠµë‹ˆë‹¤</div>
                </div>`;
        });
    }

    /* ê²°ê³¼ì°½ ìˆ¨ê¸°ê¸° ê³µí†µ í•¨ìˆ˜ */
    function hideResult() {
        document.getElementById('resultArea').style.display = 'none';
    }

    /* ì…ë ¥ê°’ ë³€ë™ ì‹œ ì—ëŸ¬ ì²´í¬ ë° ê²°ê³¼ì°½ ì´ˆê¸°í™” */
    function handleInputChange(id) {
        hideResult();
        validateLv(id);
    }

    function setAllCheckboxes(state) {
        hideResult();
        equips.forEach(eq => {
            const chk = document.getElementById(`chk-${eq.id}`);
            chk.checked = state;
            toggleRow(eq.id, false); // ì¼ê´„ ì²˜ë¦¬ ì‹œ ê²°ê³¼ì°½ ìˆ¨ê¹€ ë°˜ë³µ ë°©ì§€ ìœ„í•´ ì¸ì ì¶”ê°€
        });
    }

    function applyBatchLevel(type) {
        hideResult();
        const batchVal = document.getElementById(type === 'curr' ? 'batchCurr' : 'batchTarget').value;
        equips.forEach(eq => {
            const select = document.getElementById(`${type}-${eq.id}`);
            select.value = batchVal;
            if(!select.disabled) validateLv(eq.id);
        });
    }

    function toggleRow(id, shouldHideResult = true) {
        if(shouldHideResult) hideResult();
        const isChecked = document.getElementById(`chk-${id}`).checked;
        const row = document.getElementById(`row-${id}`);
        row.className = isChecked ? 'equip-item' : 'equip-item inactive';
        row.querySelectorAll('select').forEach(s => s.disabled = !isChecked);
        if(!isChecked) {
            document.getElementById(`error-${id}`).style.display = 'none';
            row.classList.remove('error');
        } else {
            validateLv(id);
        }
    }

    function validateLv(id) {
        const curr = parseInt(document.getElementById(`curr-${id}`).value);
        const target = parseInt(document.getElementById(`target-${id}`).value);
        const row = document.getElementById(`row-${id}`);
        const errorBox = document.getElementById(`error-${id}`);
        
        if (target < curr) {
            row.classList.add('error');
            errorBox.style.display = 'block';
            return false;
        } else {
            row.classList.remove('error');
            errorBox.style.display = 'none';
            return true;
        }
    }

    function calculateAll() {
        let total = { bri:0, moss:0, en1:0, en2:0, metal:0, light:0, crystal:0 };
        let anySelected = false;
        let globalHasError = false;

        equips.forEach(eq => {
            if(document.getElementById(`chk-${eq.id}`).checked) {
                anySelected = true;
                if(!validateLv(eq.id)) {
                    globalHasError = true;
                } else {
                    const curr = parseInt(document.getElementById(`curr-${eq.id}`).value);
                    const target = parseInt(document.getElementById(`target-${eq.id}`).value);
                    if(target > curr) {
                        const data = dataRef[eq.type];
                        for(let i = curr + 1; i <= target; i++) {
                            total.bri += data.bri[i]; total.moss += data.moss[i];
                            total.en1 += data.en1[i]; total.en2 += data.en2[i];
                            total[eq.stoneKey] += data.stone[i];
                        }
                    }
                }
            }
        });

        if(!anySelected) return;
        if(globalHasError) {
            hideResult();
            return;
        }

        document.getElementById('resultArea').style.display = 'block';
        document.getElementById('resultContent').innerHTML = `
            <div class="result-row"><div class="item-info"><img src="${icons.en1}" class="item-icon">ì—”ê·¸ë¨ 1Lv</div><span class="val-text">${total.en1.toLocaleString()}</span></div>
            <div class="result-row"><div class="item-info"><img src="${icons.en2}" class="item-icon">ì—”ê·¸ë¨ 2Lv</div><span class="val-text">${total.en2.toLocaleString()}</span></div>
            <div class="result-row"><div class="item-info"><img src="${icons.bri}" class="item-icon">ë¸Œë¦¬ ê¸°ê³„</div><span class="val-text">${total.bri.toLocaleString()}</span></div>
            <div class="result-row"><div class="item-info"><img src="${icons.moss}" class="item-icon">ëª¨ìŠ¤ ê¸°ê³„</div><span class="val-text">${total.moss.toLocaleString()}</span></div>
            <div class="stone-row">
                <div class="result-row"><div class="item-info"><img src="${icons.metal}" class="item-icon"><span class="highlight">ì‹ ë¹„í•œ ê¸ˆì†</span></div><span class="highlight">${total.metal.toLocaleString()}</span></div>
                <div class="result-row"><div class="item-info"><img src="${icons.light}" class="item-icon"><span class="highlight">ê´‘íœ˜ì„</span></div><span class="highlight">${total.light.toLocaleString()}</span></div>
                <div class="result-row"><div class="item-info"><img src="${icons.crystal}" class="item-icon"><span class="highlight">ì •ì œì„</span></div><span class="highlight">${total.crystal.toLocaleString()}</span></div>
            </div>`;
    }
    init();
</script>
</body>
</html>